/*!
 * Start Bootstrap - Modern Business v5.0.6 (https://startbootstrap.com/template-overviews/modern-business)
 * Copyright 2013-2022 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-modern-business/blob/master/LICENSE)
 */
const urlMainJson="../json/artists.json";async function updateCurrentPage(artistName){var storedArtist;if(retrieveLocalData("artistName")===artistName);else{const jsonContent=await readJson(urlMainJson);var artist=jsonContent.filter(findArtist);function findArtist(jsonContent){return jsonContent.name===artistName}storeData("artistName",artist[0].name),storeDataAsJSON("jsonContents",artist[0]),loadPage(artist[0]),WikipediaApiSearch(artist[0].name,artist[0].description),TwitterApiSearch(artist[0].name,artist[0].sameAs),spotifyPlayer(artist[0].MusicAlbum[0].MusicRecording[0].url[0].urlSpotify),loadComments(artist[0])}}function updateCurrentPageWithLocalStorage(artistName){loadPage(retrieveLocalDataAsJSON("jsonContents")),loadWikiDescription(retrieveLocalData("wiki")),loadTwitts(retrieveLocalData("twitter"),artistName),loadComments(retrieveLocalDataAsJSON("jsonContents"))}function loadWikiDescription(data){var blurb=$("<div></div>").html(data);blurb.find("a").each((function(){$(this).replaceWith($(this).html())})),blurb.find("sup").remove(),blurb.find("span").remove(),blurb.find("ol").remove(),$("#biografia").html(blurb)}function loadPage(pageContent){document.getElementById("artist_name").innerHTML=pageContent.name,document.getElementById("artist_introduction").innerHTML=pageContent.knowsAbout,document.getElementById("artist_video").setAttribute("src",pageContent.url);let album=document.getElementById("album_card");document.getElementById("album_section").innerHTML="";for(var i=0;i<pageContent.MusicAlbum.length;i++)album.childNodes[1].childNodes[1].setAttribute("src",pageContent.MusicAlbum[i].image),album.childNodes[1].childNodes[3].childNodes[5].setAttribute("href",pageContent.MusicAlbum[i].url[0].urlSpotify),album.childNodes[1].childNodes[3].childNodes[1].setAttribute("href",pageContent.MusicAlbum[i].url[0].urlYoutube),album.childNodes[3].childNodes[1].innerHTML=pageContent.MusicAlbum[i].name,album.childNodes[3].childNodes[3].innerHTML=generateSongList(pageContent.MusicAlbum[i],pageContent.genre),document.getElementById("album_section").appendChild(album.cloneNode(!0));for(var eventTable=document.createElement("tbody"),events="",i=0;i<pageContent.Event.length;i++){var index;events=events+'<tr><th scope="row">'+(i+1)+"</th>",events=(events=(events=(events+='<div property="event" typeof="Event">')+'<td property="startDate">'+pageContent.Event[i].startDate+"</td>")+'<td property="location">'+pageContent.Event[i].location+"</td>")+'<td property="url"><a href="'+pageContent.Event[i].url+'">Link</a></td>',events+="</tr>"}eventTable.innerHTML=events,document.getElementById("event_table").appendChild(eventTable),window.scrollTo({top:0})}function generateSongList(musicAlbum,genre){for(var type='property="track" typeof="MusicRecording"',metadata,songList='<meta content="'+musicAlbum.MusicRecording.length+'" property="numTracks" />\n<meta content="'+genre+'" property="genre" />'+"\n<ol>",i=0;i<musicAlbum.MusicRecording.length;i++)songList=songList+"<li><div "+type+" onclick=\"spotifyPlayer('"+musicAlbum.MusicRecording[i].url[0].urlSpotify+'\')" style="cursor:hand;cursor:pointer">'+musicAlbum.MusicRecording[i].name+"</div></li>";return songList+="</ol>"}function WikipediaApiSearch(artistName,section){jQuery.ajax({type:"GET",url:"https://es.wikipedia.org/w/api.php?action=opensearch&search="+artistName+"&callback=?",contentType:"application/json; charset=utf-8",async:!0,dataType:"json",success:function(data,textStatus,jqXHR){$.each(data,(function(i,item){var searchData;1==i&&WikipediaAPIGetContent(item[0],section)}))},error:function(errorMessage){alert("Wikipedia apiSearch"),alert(errorMessage)}})}function WikipediaAPIGetContent(search,section){jQuery.ajax({type:"GET",url:"https://es.wikipedia.org/w/api.php?action=parse&format=json&prop=text&section="+section+"&page="+search+"&callback=?",contentType:"application/json; charset=utf-8",async:!0,dataType:"json",success:function(data,textStatus,jqXHR){var markup=data.parse.text["*"];storeData("wiki",markup),loadWikiDescription(markup)},error:function(errorMessage){alert("Wikipedia getContent"),alert(errorMessage)}})}function TwitterApiSearch(artistName,artistTwitter){var twitterResponse='<a async="" class="twitter-timeline" href="https://twitter.com/'+artistTwitter+'?ref_src=twsrc%5Etfw" width="280" height="500" data-chrome="transparent">Tweets by '+artistTwitter+"</a>";reload_js("external/js/widgets.js"),storeData("twitter",twitterResponse),loadTwitts(twitterResponse,artistName)}function loadTwitts(data,artistName){document.getElementById("twitterHeading").innerHTML='<h3 class="panel-title">'+artistName+"</h3>",document.getElementById("twitterBody").innerHTML=data}function reload_js(src){$('script[src="'+src+'"]').remove(),$("<script>").attr("src",src).appendTo("body")}function spotifyPlayer(url){var song='<iframe style="border-radius:12px" src="'+url+'" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>';document.getElementById("spotify-player").innerHTML=song}function loadComments(data){var seccionComentarios=document.getElementById("comentarios"),commentarios="";for(let i=0;i<data.Review.length;i++)commentarios+='<div class="d-flex mb-3"property="review" typeof="Review"><div class="ms-3" property="reviewBody"><div class="fw-bold" property="author">'+data.Review[i].author+"</div>"+data.Review[i].text+"</div></div>";seccionComentarios.innerHTML=commentarios;var comments=retrieveLocalDataAsJSON("Reviews");if(null!=comments)for(let i=0;i<comments.length;i++)comments[i].artist==data.name&&(commentarios+='<div class="d-flex mb-3"property="review" typeof="Review"><div class="ms-3" property="reviewBody"><div class="fw-bold" property="author">'+comments[i].author+"</div>"+comments[i].text+"</div></div>");seccionComentarios.innerHTML=commentarios}async function guardarComentario(){var comentario=document.getElementById("comment").value,nombreUsuario=document.getElementById("commentor-name").value;""==nombreUsuario&&alert("Debes poner un nombre para mostrar tu comentario"),""==comentario&&alert("El campo del comentario no debe estar vacio");try{guardarComentariosLocalStorage(document.getElementById("artist_name").innerHTML,nombreUsuario,comentario)}catch(error){alert(error)}}function guardarComentariosLocalStorage(artistName,author,comment){var comments=retrieveLocalDataAsJSON("Reviews"),newComment="";if(null!=comments){var i=0;for(newComment=newComment+'[{"artist" : "'+comments[i].artist+'", "author" : "'+comments[i].author+'", "text" : "'+comments[i].text+'"},',i+=1;i<comments.length;i++)newComment=newComment+'{"artist" : "'+comments[i].artist+'", "author" : "'+comments[i].author+'", "text" : "'+comments[i].text+'"},';newComment=newComment+'{"artist" : "'+artistName+'", "author" : "'+author+'", "text" : "'+comment+'"}]'}else newComment='[{"artist" : "'+artistName+'", "author" : "'+author+'", "text" : "'+comment+'"}]';newComment=JSON.parse(newComment),storeDataAsJSON("Reviews",newComment),loadComments(retrieveLocalDataAsJSON("jsonContents")),document.getElementById("comment").value=null,document.getElementById("commentor-name").value=null}function busqueda(artistName){"Enter"===event.key&&updateCurrentPage(artistName.value)}window.onload=function(){var storedArtist=retrieveLocalData("artistName");null==storedArtist?updateCurrentPage("Rick Astley"):updateCurrentPageWithLocalStorage(storedArtist)};